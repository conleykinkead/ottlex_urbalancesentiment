{
  "hash": "7660a2a91f5cdd801b2c94eb3d7cbfd4",
  "result": {
    "markdown": "---\ntitle: \"Mapping urban-rural balance sentiment in Lexington/Fayette County, KY\"\nauthor: \n  - name: \"Conley Kinkead\"\n    url: \"https://conleykinkead.github.io/\"\n    affiliations:\n      - name: \"University of Kentucky\"\nknitr: \n  opts_chunk: \n    message: false\n    warning: false\n    fig-width: 5\n    fig-height: 3\n    fig-align: center\n    cap-location: margin\nexecute:\n  freeze: auto  # re-render only when source changes\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    toc: true\n    toc-depth: 3\n    toc-location: body\n    toc-title: \"Contents\"\n    theme: \n      light: [flatly, custom.scss]\n      dark: [darkly, custom.scss]\n    title-block-banner: true\n    include-in-header: google-font.html\n    mainfont: Quicksand\n  pdf: default\npdf-engine: pdflatex\n---\n\n\n\n## Project introduction\n\nThis project analyzes and maps urban-rural balance sentiment in Lexington/Fayette County, Kentucky using data from CivicLex's [On The Table (OTT)](https://www.ottlex.org/) survey data, which was conducted in the spring of 2022.\n\nSurvey participants completed both open response and multiple choice questions covering a variety of topics relevant to Lexington. The urban-rural balance topic is significant to Lexington as the city continues to evaluate making changes to its [Urban Service Area](https://conleykinkead.github.io/lexington_urban-service-area/index.html) and is economically and culturally intertwined with the thoroughbred horse industry, but is growing in population and other industry within the city's urban core as well.\n\nImportantly, participation in OTT was entirely voluntary, so the data and the following results shouldn't be assumed to be representative of Lexington/Fayette County residents at large. CivicLex determined the city council districts that respondents are likely to reside in based on their self-identified neighborhood of residence; thus the following analysis shows \"likely council district\" instead of \"council district\".\n\n## Prepping for analysis\n\n### Installing packages\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ninstall.packages(\"tidyverse\")\ninstall.packages(\"tidytext\")\ninstall.packages(\"janitor\")\ninstall.packages(\"fs\")\ninstall.packages(\"here\")\ninstall.packages(\"sf\")\ninstall.packages(\"tmap\")\ninstall.packages(\"RColorBrewer\")\ninstall.packages(\"quanteda\")\ninstall.packages(\"quanteda.textplots\")\ninstall.packages(\"quanteda.textstats\")\ninstall.packages(\"textdata\")\n```\n:::\n\n\n\n### Loading packages\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(fs)\nlibrary(here)\nlibrary(tidytext)\nlibrary(sf)\nlibrary(tmap)\nlibrary(RColorBrewer)\nlibrary(quanteda)\nlibrary(quanteda.textplots)\nlibrary(quanteda.textstats)\nlibrary(textdata)\n```\n:::\n\n\n\n## OTT data\n\n### Downloading CivicLex On The Table (OTT) data\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndir_create(here(\"data\", \"zipfiles\"))\ndownload.file(\n  \"https://www.ottlex.org/s/OTT-2022-Raw-Data.zip\",\n  destfile = here(\"data\", \"zipfiles\", \"ott.zip\")\n  )\n```\n:::\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndir_create(here(\"data\", \"ott\")) \nunzip(\n  zipfile = here(\"data\", \"zipfiles\", \"ott.zip\"),\n  junkpaths = T,\n  exdir = here(\"data\", \"ott\")\n)\n```\n:::\n\n\n\n### Tidying OTT data\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nott_data <- read_csv(here(\"data\", \"ott\", \"OTT Raw Data-Raw Data Grid.csv\")) |> \n  clean_names()\n```\n:::\n\n\n\n### Selecting the required data\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nott_data |>\n  select(\n    ott_raw_data_response,\n    likely_council_district,\n    ur_balance_or\n    )|>\n  pivot_longer(\n    ur_balance_or,\n    values_to = \"response\"  \n) |>\n  mutate(\n    response = str_squish(response)\n  ) |>\n  filter(\n    str_length(response) > 0\n  ) |>\n  mutate(\n    docid = str_c(ott_raw_data_response, sep = \"_\")\n  ) -> ur_balance_tidy\n```\n:::\n\n\n\n## Sentiment analysis of Lexington's urban-rural balance\n\n### Combining urban-rural balance open responses by likely council district\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_balance_tidy |>\n    filter(\n    str_length(likely_council_district) < 3\n    ) |>\n  group_by(likely_council_district) |>\n  summarise(text = str_flatten(response, collapse = \" \")) -> district_response\n```\n:::\n\n\n\n### Measuring urban-rural balance sentiment by likely council district\n\n#### Tokenizing responses\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndistrict_response |>\n  unnest_tokens(\n    word,\n    text,\n    token = \"words\"\n  ) -> district_response_tokens\n```\n:::\n\n\n\n#### Joining tokens with AFFIN lexicon\n\n[AFFIN](https://search.r-project.org/CRAN/refmans/textdata/html/lexicon_afinn.html) is a dataset containing a lexicon of English words rated -5 to +5 based on their sentiment, with -5 being the most negative, 0 being neutral, and +5 being the most positive.\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndistrict_response_tokens |>\n  mutate(\n    word_location = row_number()\n  ) |>\n  inner_join(\n    get_sentiments(\"afinn\")\n  ) -> ur_sentiments\n```\n:::\n\n\n\n#### Grouping and averaging sentiment by likely council district\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_sentiments |>\n  group_by(likely_council_district) |>\n  summarise(\n    sentiment = mean(value)\n  ) -> ur_district_sentiment\n```\n:::\n\n\n\n#### Plot of urban-rural balance sentiment by likely council district\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_district_sentiment |>\n  ggplot(aes(likely_council_district, sentiment)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![Rough urban-rural balance sentiment for likely council districts plot to begin visualizing the data.](final-project_files/figure-pdf/unnamed-chunk-11-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Mapping sentiment by likely council district\n\n### Adding council district spatial data\n\n#### Downloading [council district GeoJSON](https://data.lexingtonky.gov/datasets/5bab826b97c84d229f7abf0bc947981c_0/explore?location=38.027862%2C-84.471932%2C11.56) from [Lexington's Data Hub](https://data.lexingtonky.gov/)\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nlex_councils <- read_sf(\"https://services1.arcgis.com/Mg7DLdfYcSWIaDnu/arcgis/rest/services/Council_District/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson\")\n```\n:::\n\n\n\n### Joining council district spatial df with sentiment analysis df\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_district_sentiment |>\n  mutate(\n    DISTRICT = as.numeric(likely_council_district)\n  ) -> ur_district_sentiment_dbl\n```\n:::\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndistrict_sentiment <-\n  merge(ur_district_sentiment_dbl,lex_councils)\n```\n:::\n\n\n\n#### Making merged df a spatial df\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ndistrict_sentiment_sf = st_as_sf(district_sentiment)\n```\n:::\n\n\n\n## Map of urban-rural balance sentiment\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\ntm_shape(district_sentiment_sf) +\n  tm_polygons(col = \"sentiment\", palette = \"Blues\") +\n  tm_credits(\"Data sources: CivicLex; LFUCG\", size = 0.9, position = c(\"left\",\"top\")) +\n  tm_credits(\"Author: Conley Kinkead\", size = 0.9, position = c(\"left\",\"top\")) +\n  tm_scale_bar(position = c(\"right\", \"bottom\")) +\n  tm_layout(main.title = \"Urban-rural balance sentiment by likely council district\",\n            fontface = \"italic\",\n            fontfamily = \"serif\",\n            main.title.size = 1.5) +\n  tm_legend(\n  legend.title.size = 1.2,\n  legend.title.fontface = \"bold\",\n  legend.text.size = 0.9,\n  legend.bg.color = \"white\",\n  legend.position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![Urban-rural balance sentiment by likely council district map. A higher sentiment value represents a more positive sentiment.](final-project_files/figure-pdf/unnamed-chunk-16-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n### Results\n\nThis map shows that residents of all council districts have a positive sentiment regarding Lexington's urban-rural balance, but at varying degrees. AFINN ratings range from -5 (very negative) to +5 (very positive), with 0 indicating a neutral sentiment. A lower sentiment score on this map indicates a less positive sentiment, and a higher score indicates a more positive sentiment.\n\nThe results showing that the OTT participants who are likely residents of council district 12 have the least positive sentiment regarding Lexington's urban-rural balance is interesting. District 12 covers the primarily agricultural area of Lexington/Fayette County, wrapping around the city's central area, and largely overlapping with the Rural Service Area.\n\n## A little more analysis: Urban-rural balance response content analysis using quanteda\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_balance_tidy |>\n  corpus(\n    docid_field = \"docid\",\n    text_field = \"response\"\n  ) -> ur_balance_corpus\n```\n:::\n\n\n\n#### Corpus to tokens\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_balance_corpus |>\n  tokens(remove_punct = T) |>\n  tokens_tolower() |>\n  tokens_remove(pattern = stopwords()) |>\n  tokens_compound(pattern = list(c(\"man\", \"o\", \"war\"), c(\"horse\", \"capital\"))) -> ur_balance_tokens\n```\n:::\n\n\n\n#### Tokens to DFM\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_balance_tokens |>\n  dfm() -> ur_balance_dfm\n```\n:::\n\n\n\n### Keyness plot of likely council district 12 urban-rural balance response content versus all others\n\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nur_balance_dfm |>\n  dfm_group(groups = ur_balance_dfm$likely_council_district) |>\n  textstat_keyness(target = \"12\") |>\n  textplot_keyness()\n```\n\n::: {.cell-output-display}\n![Keyness plot of urban-rural balance response content. This plot shows the words that are key for differentiating urban-rural balance open response content for likely residents of council district 12 versus all other council districts in Lexington/Fayette County.](final-project_files/figure-pdf/unnamed-chunk-20-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n### Results\n\nThis keyness plot shows words or phrases that respondents who are likely residents of council district 12 used more often in comparison to respondents who are likely residents of all other council districts combined. The words and phrases plotted in blue are the key differentiating terms for likely council district 12 urban-rural balance open responses, while the words plotted in grey represent the key differential words for the same responses for likely residents of all other council districts combined.\n",
    "supporting": [
      "final-project_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}